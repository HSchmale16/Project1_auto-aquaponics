\documentclass[american,man,12pt]{apa6}

\usepackage{hyperref}
\usepackage{babel}
\usepackage{csquotes}
\usepackage[backend=biber,date=short,maxcitenames=2,style=apa]{biblatex}
\usepackage{enumitem}
\usepackage{tikz}

\usetikzlibrary{patterns}

\DeclareLanguageMapping{american}{american-apa}

\title{Automated Aquaponics Developer Setup Manual}
\shorttitle{AutoAquaponics}
\author{Henry J Schmale}
\affiliation{Harrisburg University of Science and Technology}
\date{\today}

\addbibresource{project.bib}
\nocite{*}

\begin{document}
\maketitle
%\tableofcontents

\section{Introduction}
This manual provides the documentation for my partially automated aquaponics
system. The system provides facilities for monitoring fish count, water level,
water temperature, and air quality factors. It also provides control systems
for toggling the pumps on and off, along with lighting factors for the tank.

\section{System Architecture}
The control system consists of many parts, such as the database, data collection
and control, and web interface. The database provides storage of the various
events and readings collected. The web interface provides control of the various
components to the user, and allows the user to view the current status of the system.
The data and control system manages the connection to the microcontroller, and collects
data from the various sensors, it also manages the toggling of the various pumps and
lights to keep the fish alive.



\subsection{Serial Communication Protocol}
This section describes the command protocol used to communicate with the
microcontroller over serial. The protocol is that of a client and server,
with line delimitation. The first step is for the client, in this case the
main computer, to send a command in the list of known commands. The server,
arduino, receives the command and performs the action. Over the same link, it
will send back the command and the value returned separated by a space. By
duplicating the command it allows multiple commands to be queued over the same
link, without worry of the data being muddled.

\begin{description}[style=nextline]
	\item[rWatThm] read the water thermometer
	\item[rdWaLvl] read the distance measuring device to obtain distance to water.
	\item[rdHumid] read the current humidity in the room
	\item[rdAirTm] read the current air temperature
\end{description}

\subsection{Sensors}
This section describes the various sensors used to monitor the system, and their
purpose. These sensors include temperature probes, distance measuring devices,
and humidity. These sensors allow the user to correlate the data with how well
their fish are doing.

\subsubsection{Water Level with Distance Measuring}
The depth of the water is measured using an ultrasonic distance sensor. It uses
sound to find how distant an object is, in this case the surface of the water.
This method assumes that the total distance between the sensor and the container
bottom is known as $D_t$, and the distance between the water surface and the sensor
is known as $D_a$. The water depth is then obtained using the following formula,
$D_w = D_t - D_a$. Please see figure~\ref{fig:distance measuring} for details on the
measurement.

\begin{figure}[h]
	\centering
	\begin{tikzpicture}
	\draw[fill=red] (0.75,4) rectangle (1.5,4.5);
    \draw (0,0) rectangle (5, 4);
    \draw[fill=blue](0,0) rectangle (5,2);
    % dim lines
    \draw[<->,black] (.85,0) -- node[left]{$D_t$}  (.85,4);
    \draw[<->,black] (1.25,0) -- node[right]{$D_{w}$} (1.25,2);
    \draw[<->,black] (1.25,2) -- node[right]{$D_{a}$} (1.25,4);
	\end{tikzpicture}
	\caption{How the distance measuring works}
	\label{fig:distance measuring}
\end{figure}

\subsubsection{Air Temperature and Humidity}
The air temperature and humidity is obtained using a DHT series sensor. It can
use any sensor in this series so long as the code on the microcontroller is
updated. The Adafruit Unified Sensor library is used with DHT extension to
perform this interfacing on the
microcontroller(\cite{adafruit-unified-sensor,adafruit-dht}). The current system
uses the DHT11 sensor, as this was the most common sensor available at build
time.

\subsubsection{Water Temperature}
The measurement of water temperature is carried out using Dallas Temperature
Probe. This sensor is interfaced using the Maxim Temperature Integrated Circuit
Library (\cite{gh-arduino-temperature}). The current system uses
a DST18B20 sensor.

\section{Parts List}
\begin{itemize}
	\item Large Plastic Reservoir.
	\item 3 inch PVC Pipe, 5 foot long.
	\item Net Pots
	\item 390 Gallon Per Hour Submersible Pump
    \item 2 - 1/2 inch hose barbs threaded
    \item Hose Clamps
    \item GFCI Outlet
    \item Regular Outlets
    \item Arduino Mega
\end{itemize}

\section{Diagram}
Please see figure~\ref{fig:front view} and figure~\ref{fig:top view} for
details of how the system is laid out. Due to the way the apa6 package works the
diagrams must be referenced and cannot be placed here, but are at the end. These
diagrams are not to scale, and are not absolute as the number of holes may vary
and the dimensions are up to the user. They are to give a general idea of a
finished system.

% Front View
\begin{figure}[h]
    \centering
    \begin{tikzpicture}
        \draw (0,0) rectangle (6, 4);
        \draw (0,4) -- (.25,4.25) -- (5.75,4.25) -- (6,4);
        \draw (-1,4.25) rectangle (7,4.75);
    \end{tikzpicture}
    \caption{Front View of Aquaponics System}
    \label{fig:front view}
\end{figure}

% Top VIew
\begin{figure}[h]
    \centering
    \begin{tikzpicture}
        \draw (0,0) rectangle (6, 3);
        \draw[fill=white] (-1,1.25) rectangle (7,1.75);
    \end{tikzpicture}
    \caption{Top View of Aquaponics System}
    \label{fig:top view}
\end{figure}


\section{How To Build}
\begin{enumerate}
	\item Drill PVC pipe with hole saw. Start placing holes 7 inches from the
		  end, and then 6 inches on center. Continue until you have reached
		  the end of the pipe, but still have about 7 inches.
\end{enumerate}


\section{Starting a new garden}
This section describes how to start a new crop in the automated aquaponics
system. It is broken down into two sections, the fish and starting the plants.

\begin{enumerate}
	\item Fill tank with water.
	\item Start pump circulation.
	\item Introduce the fish to the system.
	\item Start plants in the rockwool plugs.
\end{enumerate}



\section{Troubleshooting}
To be written.


\printbibliography
\end{document}
